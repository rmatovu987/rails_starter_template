<% content_for :title, "Showing user" %>

<%= render 'shared/breadcrumbs' %>
<div id="<%= dom_id @user %>">
  <!-- Main content -->
  <div class="h-[calc(100lvh_-_10.5rem)] flex flex-wrap ">
    <div class="w-full md:w-2/3 md:overflow-scroll max-h-max md:max-h-full">
      <div class="white_card_no_margin lg:me-5">
        <div class="w-full mb-4"><span class="card-title">User details</span></div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
        <div class="col-span-1 ps-1">
          <div class="avatar mb-5">
            <div class="w-55 rounded ring-primary ring-offset-base-100 ring-2 ring-offset-2">
              <% if @user.avatar.attached? %>
                <%= image_tag @user.avatar %>
              <% else %>
                <%= image_tag 'avater.jpg', class: 'w-55 rounded' %>
              <% end %>
            </div>
          </div>
        </div>
        <div class="me-5 col-span-2">
          <div class="flex flex-wrap">
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">ID:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <%= @user.unique_id %>
              </div>
            </div>
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">Encoded key:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <%= @user.encoded_key %>
              </div>
            </div>
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">Name:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <%= @user.firstname %> <%= @user.lastname %>
              </div>
            </div>
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">Email address:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <%= @user.email_address %>
              </div>
            </div>
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">Status:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <% if @user.status == 'Inactive' %>
                  <%= render partial: "shared/badge", locals: { status: Statuses::SECONDARY, label: @user.status } %>
                <% elsif @user.status == 'Active' %>
                  <%= render partial: "shared/badge", locals: { status: Statuses::SUCCESS, label: @user.status } %>
                <% elsif @user.status == 'Suspended' %>
                  <%= render partial: "shared/badge", locals: { status: Statuses::ERROR, label: @user.status } %>
                <% end %>
              </div>
            </div>
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">Time Zone:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <%= @user.time_zone %>
              </div>
            </div>
            <div class="w-full flex space-y-4">
              <div class="w-3/6 md:w-2/6 space-y-4">
                <strong class=" description">Assigned Branch:</strong>
              </div>
              <div class="leading-relaxed font-normal">
                <%= @user.assigned_branch.name %>
              </div>
            </div>
          </div>
          <div class="w-full space-x-3 flex justify-end mt-6">
            <% unless @user.super_user %>
              <%= link_to "Destroy", @user,
                          class: "btn btn-error",
                          data: { turbo_confirm: "Are you sure you want to delete this user?",
                                  turbo_method: :delete } %>
            <% end %>

            <%= link_to "Edit", edit_user_path(@user),
                        class: "btn btn-primary", data: { turbo_frame: "modal" } %>
          </div>
        </div>
      </div>
      </div>
      <div class="flex flex-wrap mt-5 me-5">
        <div class="w-full md:w-1/2">
          <div class="white_card_no_margin">
            <div class="flex flex-wrap">
              <div class="w-full mb-2"><span class="card-title">User contact</span></div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Primary phone number:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.contact.get_primary_phone_number %>
                </div>
              </div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Primary email:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.contact.get_primary_email %>
                </div>
              </div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Secondary phone number:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.contact.get_secondary_phone_number %>
                </div>
              </div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Secondary email:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.contact.get_secondary_email %>
                </div>
              </div>
            </div>
            <div class="w-full space-x-3 flex justify-end mt-6">
              <% link_to "Destroy", @user.contact,
                          class: "btn btn-error",
                          data: { turbo_confirm: "Are you sure you want to delete this contact?",
                                  turbo_method: :delete } %>

              <%= link_to "Edit", edit_shared_contact_path(@user.contact),
                          class: "btn btn-primary", data: { turbo_frame: "modal" } %>
            </div>
          </div>
        </div>
        <div class=" w-full md:w-1/2">
          <div class="white_card_no_margin ms-0 md:ms-5 mt-5 md:mt-0">
            <div class="flex flex-wrap">
              <div class="w-full mb-2"><span class="card-title">User address</span></div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Street name:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.address.get_street_name %>
                </div>
              </div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">City:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.address.get_city %>
                </div>
              </div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Region:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.address.get_region %>
                </div>
              </div>
              <div class="w-full flex space-y-4">
                <div class="w-1/2 space-y-4">
                  <strong class=" description">Country:</strong>
                </div>
                <div class="leading-relaxed font-normal">
                  <%= @user.address.get_country %>
                </div>
              </div>
            </div>
            <div class="w-full space-x-3 flex justify-end mt-6">
              <% link_to "Destroy", @user.address,
                          class: "btn btn-error",
                          data: { turbo_confirm: "Are you sure you want to delete this address?",
                                  turbo_method: :delete } %>

              <%= link_to "Edit", edit_shared_address_path(@user.address),
                          class: "btn btn-primary", data: { turbo_frame: "modal" } %>
            </div>
          </div>
        </div>
      </div>
      <div class="white_card_no_margin lg:me-5 mt-5">
        <div class="flex flex-wrap">
          <div class="w-full mb-2  flex justify-between">
            <span class="card-title">User Roles</span>
            <%= link_to "Assign Role", add_role_user_path(@user),
                        class: "btn btn-primary btn-outline", data: { turbo_frame: "modal" } %>
          </div>
          <div class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100 w-full">
            <table class="table">
              <!-- head -->
              <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Description</th>
                <th>Status</th>
                <th class="no-export">Action</th>
              </tr>
              </thead>
              <tbody>
              <% @user.roles.each_with_index do |role, index| %>
                <tr>
                  <th><%= index + 1 %></th>
                  <td><%= role.name %></td>
                  <td><%= role.description %></td>
                  <td>
                    <% if role.status == 'Pending' %>
                      <%= render partial: "shared/badge", locals: { status: Statuses::PRIMARY, label: role.status } %>
                    <% elsif role.status == 'Active' %>
                      <%= render partial: "shared/badge", locals: { status: Statuses::SUCCESS, label: role.status } %>
                    <% elsif role.status == 'Inactive' %>
                      <%= render partial: "shared/badge", locals: { status: Statuses::ERROR, label: role.status } %>
                    <% end %>
                  </td>
                  <td>
                    <%= button_to revoke_role_user_path(@user, role_id: role), method: :post, class: "text-error" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2">
                        <path d="M3 6h18"/>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                        <line x1="10" x2="10" y1="11" y2="17"/>
                        <line x1="14" x2="14" y1="11" y2="17"/>
                      </svg>
                    <% end %>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="white_card_no_margin lg:me-5 mt-5">
        <div class="flex flex-wrap">
          <div class="w-full mb-2 flex justify-between">
            <span class="card-title">User Branches</span>
            <%= link_to "Attach Branch", add_branch_user_path(@user),
                        class: "btn btn-primary btn-outline", data: { turbo_frame: "modal" } %>
          </div>
          <div class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100 w-full">
            <table class="table">
              <!-- head -->
              <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Status</th>
                <th>Is Main</th>
                <th class="no-export">Action</th>
              </tr>
              </thead>
              <tbody>
              <% @user.branches.each_with_index do |branch, index| %>
                <tr>
                  <th><%= index + 1 %></th>
                  <td><%= branch.name %></td>
                  <td>
                    <% if branch.status == 'Pending' %>
                      <%= render partial: "shared/badge", locals: { status: Statuses::SECONDARY, label: branch.status } %>
                    <% elsif branch.status == 'Active' %>
                      <%= render partial: "shared/badge", locals: { status: Statuses::SUCCESS, label: branch.status } %>
                    <% elsif branch.status == 'Closed' %>
                      <%= render partial: "shared/badge", locals: { status: Statuses::ERROR, label: branch.status } %>
                    <% end %>
                  </td>
                  <td><%= branch.isMain ? 'Yes' : 'No' %></td>
                  <td>
                    <%= button_to detach_branch_user_path(@user, branch_id: branch), method: :post, class: "text-error" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2">
                        <path d="M3 6h18"/>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                        <line x1="10" x2="10" y1="11" y2="17"/>
                        <line x1="14" x2="14" y1="11" y2="17"/>
                      </svg>
                    <% end %>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="w-full md:w-1/3 mt-5 md:mt-0 white_card_no_margin md:overflow-scroll max-h-max md:max-h-full">
      <div class="font-bold text-2xl mb-4">Timeline</div>
      <%= render partial: 'shared/timeline', locals: { versions: @versions } %>
    </div>

  </div>
  <!-- End of main content -->
</div>
