<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= content_for(:title) || "Rails Starter Template" %></title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content=<%= content_for(:title) || "Rails Starter Template" %>>
  <meta name="application-name" content="Rails Starter Template">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
  <%= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

  <%# Includes all stylesheet files in app/assets/stylesheets %>
  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= javascript_include_tag "date_range_picker.js" %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>

  <% if authenticated? %>
    <%= javascript_tag do %>
      const SESSION_TIMEOUT = <%= SessionConfig::SESSION_TIMEOUT.to_i * 1000  %>;
      let timeout = null;

      function resetTimer() {
      if (timeout !== null) {
      clearTimeout(timeout);
      }
      timeout = setTimeout(() => {
      alert("Your session has timed out. You will be redirected to the login page.");
      window.location.href = "<%= new_session_path %>";
      document.getElementById('logout-form-on-timeout').submit();
      }, SESSION_TIMEOUT);
      }

      if (!window.sessionTimeoutInitialized) {
      window.sessionTimeoutInitialized = true;
      document.addEventListener('turbo:load', resetTimer); // Use turbo:load
      }
    <% end %>
  <% end %>
</head>

<body class="bg-zinc-100 transition-all duration-300 lg:hs-overlay-layout-open:ps-65
   dark:bg-zinc-900 hs-overlay-body-open">
<% if authenticated? %>
  <%= form_with url: session_path, method: :delete, id: 'logout-form-on-timeout', class: 'hidden' do %>
  <% end %>
<% end %>

<!-- ========== MAIN CONTENT ========== -->
<main id="content" class="h-lvh overflow-scroll max-h-full">
  <%= render "shared/toast" %>
  <%#= render "layouts/shared/navbar" %>

  <%#= render "layouts/shared/sidebar" %>

  <!-- Modal frame -->
  <dialog class="modal modal-bottom sm:modal-middle"
          tabindex="-1"
          data-controller="modal"
          data-action="turbo:frame-load->modal#open turbo:submit-end->modal#close"
  >
    <div class="modal-box ">
      <%= turbo_frame_tag "modal" %>
    </div>
  </dialog>

  <!-- Content -->
  <div class="w-full">
    <div class="px-4 py-2 sm:px-5 space-y-4 sm:space-y-6">
      <%= yield %>
    </div>
  </div>
  <!-- End Content -->
</main>
<!-- ========== END MAIN CONTENT ========== -->
</body>
</html>
